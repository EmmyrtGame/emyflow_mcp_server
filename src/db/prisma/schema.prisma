generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Admin {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String   // Hash bcrypt
  email     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Client {
  id        String   @id @default(cuid())
  slug      String   @unique  // Ej: "white_dental"
  name      String              // Nombre visible
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Configuraciones anidadas (JSON)
  meta            Json  // { pixelId, accessToken }
  wassenger       Json  // { apiKey, deviceId }
  // Removed legacy location and availabilityStrategy fields
  locations       Json? // MÃºltiples sedes (opcional)
  reminderTemplates Json  // { "24h", "3h", "1h" }
  
  // Relations
  serviceAccountId String?
  serviceAccount   ServiceAccount? @relation(fields: [serviceAccountId], references: [id])

  // Metadatos
  timezone              String  @default("America/Mexico_City")
  wassengerDeviceId     String? @unique
}

model ServiceAccount {
  id          String   @id @default(cuid())
  name        String   @unique // Identifier (e.g., project_id or filename)
  email       String?  // client_email derived from JSON
  fileName    String?  // Original filename for display
  encryptedContent String @db.Text // JSON content usually
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  clients     Client[]
}
